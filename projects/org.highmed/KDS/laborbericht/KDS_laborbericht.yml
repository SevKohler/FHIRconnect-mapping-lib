grammar: FHIRConnect/v1.0.0
type: extension
metadata:
  name: KDS_laborbericht
  version: 0.0.1-alpha
spec:
  system: FHIR
  version: R4
  extends: OBSERVATION.laboratory_test_result.v1

mappings:
  - name: "compositionMapping"
    extension: "add"
    with:
      fhir: "$resource"
      openehr: "$composition"
    slotArchetype: "COMPOSITION.report_result.v1.DiagnosticReport"

  - name: "resultAppendToParent" #/data[at0001]/events[at0002] add new for each laboratory analyte.
    extension: "append"
    appendTo: "eventParent"
    followedBy:
      mappings:
        - name: "result"
          with:
            fhir: "result"
            openehr: "$reference" #will create FOR each result ONE event.
          reference:
            resourceType: "Observation"
            mappings:
              - name: "observationRecurring"
                with:
                  fhir: "$fhirRoot"
                  openehr: "data[at0003]/items[openEHR-EHR-CLUSTER.laboratory_test_analyte.v1]"
                slotArchetype: "CLUSTER.laboratory_test_analyte.v1"









